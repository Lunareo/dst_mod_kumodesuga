if string.find(MODROOT, "workshop") then return end

local CTRL_INDEX = {
    [-1] = CONTROL_OPEN_DEBUG_MENU, -- not IsConsole(), IsConsole() and 70 or -1 --62 steam deck is 70
    [0] = CONTROL_PRIMARY,
    [1] = CONTROL_SECONDARY,
    [2] = CONTROL_ATTACK,
    [3] = CONTROL_INSPECT,
    [4] = CONTROL_ACTION,
    [5] = CONTROL_MOVE_UP,
    [6] = CONTROL_MOVE_DOWN,
    [7] = CONTROL_MOVE_LEFT,
    [8] = CONTROL_MOVE_RIGHT,
    [9] = CONTROL_ZOOM_IN,
    [10] = CONTROL_ZOOM_OUT,
    [11] = CONTROL_ROTATE_LEFT,
    [12] = CONTROL_ROTATE_RIGHT,
    [13] = CONTROL_PAUSE,
    [14] = CONTROL_MAP,
    [15] = CONTROL_INV_1,
    [16] = CONTROL_INV_2,
    [17] = CONTROL_INV_3,
    [18] = CONTROL_INV_4,
    [19] = CONTROL_INV_5,
    [20] = CONTROL_INV_6,
    [21] = CONTROL_INV_7,
    [22] = CONTROL_INV_8,
    [23] = CONTROL_INV_9,
    [24] = CONTROL_INV_10,
    [25] = CONTROL_FOCUS_UP,
    [26] = CONTROL_FOCUS_DOWN,
    [27] = CONTROL_FOCUS_LEFT,
    [28] = CONTROL_FOCUS_RIGHT,
    [29] = CONTROL_ACCEPT,
    [30] = CONTROL_CANCEL,
    [31] = CONTROL_SCROLLBACK,
    [32] = CONTROL_SCROLLFWD,
    [33] = CONTROL_PREVVALUE,
    [34] = CONTROL_NEXTVALUE,
    [35] = CONTROL_SPLITSTACK,
    [36] = CONTROL_TRADEITEM,
    [37] = CONTROL_TRADESTACK,
    [38] = CONTROL_FORCE_INSPECT,
    [39] = CONTROL_FORCE_ATTACK,
    [40] = CONTROL_FORCE_TRADE,
    [41] = CONTROL_FORCE_STACK,
    [42] = CONTROL_OPEN_DEBUG_CONSOLE,
    [43] = CONTROL_TOGGLE_LOG,
    [44] = CONTROL_TOGGLE_DEBUGRENDER,
    [45] = CONTROL_OPEN_INVENTORY,
    [46] = CONTROL_OPEN_CRAFTING,
    [47] = CONTROL_INVENTORY_LEFT,
    [48] = CONTROL_INVENTORY_RIGHT,
    [49] = CONTROL_INVENTORY_UP,
    [50] = CONTROL_INVENTORY_DOWN,
    [51] = CONTROL_INVENTORY_EXAMINE,
    [52] = CONTROL_INVENTORY_USEONSELF,
    [53] = CONTROL_INVENTORY_USEONSCENE,
    [54] = CONTROL_INVENTORY_DROP,
    [55] = CONTROL_PUTSTACK,
    [56] = CONTROL_CONTROLLER_ATTACK,
    [57] = CONTROL_CONTROLLER_ACTION,
    [58] = CONTROL_CONTROLLER_ALTACTION,
    [59] = CONTROL_USE_ITEM_ON_ITEM,
    [60] = CONTROL_MAP_ZOOM_IN,
    [61] = CONTROL_MAP_ZOOM_OUT,
    [63] = CONTROL_TOGGLE_SAY,
    [64] = CONTROL_TOGGLE_WHISPER,
    [65] = CONTROL_TOGGLE_SLASH_COMMAND,
    [66] = CONTROL_TOGGLE_PLAYER_STATUS,
    [67] = CONTROL_SHOW_PLAYER_STATUS,
    [68] = CONTROL_MENU_MISC_1,
    [69] = CONTROL_MENU_MISC_2,
    [70] = CONTROL_MENU_MISC_3,
    [71] = CONTROL_MENU_MISC_4,
    [72] = CONTROL_INSPECT_SELF,
    [73] = CONTROL_SERVER_PAUSE,
    [74] = CONTROL_CRAFTING_MODIFIER,
    [75] = CONTROL_CRAFTING_PINLEFT,
    [76] = CONTROL_CRAFTING_PINRIGHT,
    [77] = CONTROL_INV_11,
    [78] = CONTROL_INV_12,
    [79] = CONTROL_INV_13,
    [80] = CONTROL_INV_14,
    [81] = CONTROL_INV_15,
    [82] = CONTROL_START_EMOJI,
    [83] = CONTROL_MENU_BACK,
    [84] = CONTROL_MENU_START,
    [85] = CONTROL_MENU_L2,
    [86] = CONTROL_MENU_R2,
    [87] = CONTROL_OPEN_COMMAND_WHEEL,
    [88] = CONTROL_TARGET_LOCK,
    [89] = CONTROL_TARGET_CYCLE,
    [90] = CONTROL_CAM_AND_INV_MODIFIER,
    [91] = CONTROL_CHARACTER_COMMAND_WHEEL,
    [92] = CONTROL_PRESET_RSTICK_UP,
    [93] = CONTROL_PRESET_RSTICK_DOWN,
    [94] = CONTROL_PRESET_RSTICK_LEFT,
    [95] = CONTROL_PRESET_RSTICK_RIGHT,
    [96] = CONTROL_PRESET_DPAD_UP,
    [97] = CONTROL_PRESET_DPAD_DOWN,
    [98] = CONTROL_PRESET_DPAD_LEFT,
    [99] = CONTROL_PRESET_DPAD_RIGHT,
    [100] = CONTROL_AXISALIGNEDPLACEMENT_TOGGLEMOD,
    [101] = CONTROL_AXISALIGNEDPLACEMENT_CYCLEGRID,
}

local control_debug_flag, control_down_flag = false, false
local PlayerController = require "components/playercontroller"
UTIL.FnExtend(PlayerController, "OnControl", function(_, control, down)
    if TheWorld.ismastersim then return end
    if control_debug_flag and (not control_down_flag or control_down_flag == down) then
        print("[DEBUG] PlayerController:OnControl(", CTRL_INDEX[control], down, ")")
    end
end)

GLOBAL.r_printcontrol = function(control, down)
    control_debug_flag, control_down_flag = not not control, not not down
end